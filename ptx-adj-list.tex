% ptx-adj-list.tex
% paragraph adjustment from auxiliary file

\catcode`\@=11

\def\parse@djline #1 #2.#3 #4\end{%
 \uppercase{\gdef\@djref{#1#2.#3}}\gdef\@djustment{#4}%
}

\def\do@dj{%
 \looseness=\@djustment
 \readnext@dj
}

\def\readnext@dj{%
 \ifeof\@djlist
  \let\@djref\empty
 \else
  \begingroup
   \catcode`0=12 \catcode`1=12 \catcode`2=12 \catcode`3=12 \catcode`4=12
   \catcode`5=12 \catcode`6=12 \catcode`7=12 \catcode`8=12 \catcode`9=12
   \catcode`.=12 \catcode`+=12 \catcode`-=12 \catcode`\%=5
   \endlinechar=-1
   \read\@djlist to \@djline
   \ifx\@djline\P@R\readnext@dj\else
    \ifx\@djline\empty\readnext@dj\else
     \expandafter\parse@djline\@djline\end
    \fi
   \fi
  \endgroup
 \fi
}
\def\P@R{\par}

\newread\@djlist
\def\openadjlist "#1" {%
 \closein\@djlist
 \openin\@djlist="#1"
 \ifeof\@djlist \immediate\write16{(no adjustment list "#1" found)}%
 \else \immediate\write16{(using adjustment list "#1")}\fi
 \readnext@dj
}
\def\closeadjlist{%
 \ifeof\@djlist\else \errmessage{Did not use all adjustments in list}\fi
 \closein\@djlist
}

\def\ch@ckadjustments{%
 \edef\c@rref{\id@@@\ch@pter.\v@rse}%
 \ifx\c@rref\@djref \do@dj \fi}

\addtoversehooks{\ch@ckadjustments}

\catcode`\@=12

\endinput
