%:strip
% Part of the ptx2pdf macro package for formatting USFM text
% copyright (c) 2007-2020 by SIL International
% written by David Gardner and pior editors of ptx-char-style
%
% Permission is hereby granted, free of charge, to any person obtaining  
% a copy of this software and associated documentation files (the  
% "Software"), to deal in the Software without restriction, including  
% without limitation the rights to use, copy, modify, merge, publish,  
% distribute, sublicense, and/or sell copies of the Software, and to  
% permit persons to whom the Software is furnished to do so, subject to  
% the following conditions:
%
% The above copyright notice and this permission notice shall be  
% included in all copies or substantial portions of the Software.
%
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,  
% EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  
% MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  
% NONINFRINGEMENT. IN NO EVENT SHALL SIL INTERNATIONAL BE LIABLE FOR  
% ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF  
% CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION  
% WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
%
% Except as contained in this notice, the name of SIL International  
% shall not be used in advertising or otherwise to promote the sale,  
% use or other dealings in this Software without prior written  
% authorization from SIL International.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifin@ttrib
\def\@ttrSlash#1\*{\xdef\attrib@rgs{#1}\message{Attr:\attrib@rgs}\*}


\catcode`\|=\active
\def\use@ttrSlash{%
    \let|=\@ttrSlash %this one is easy
}
\def\use@ttrGrab{%
    \let|=\start@ttributegrab %have to build attributes char-by-char, sadly.
}
\catcode`\|=12

\def\init@ttribs{%
 % Attribute pre-setupcode goes here.
  \catcode`\|=\active
  %\ifmst@nestyle
  \iffalse
    \use@ttrSlash
  \else
    \use@ttrGrab
  \fi
  \def\attrst@ck{,}%
  \in@ttribfalse
  \xdef\@ttributes{}%
}

\def\proc@ttribs{%
  \ifin@ttrib
    \trace{A}{Attributes specified:\attrib@rgs}%
    \in@ttribfalse
  \fi
  \catcode`\|=12
}


\edef\p@stattribcmd{}
\def\store@ttributes#1{\def\newbit{#1}\message{'\newbit'}\edef\@ttributes{\@ttributes\newbit}\futurelet\nxt\isitshash}                                                                    
\def\startp@stattribcmd#1{\futurelet\nxt\isitcmd}
\def\storep@stattribcmd#1{\def\newbit{#1}\message{"\newbit"}\edef\p@stattribcmd{\p@stattribcmd\newbit}\futurelet\nxt\isitcmd}                                                                          
\lccode`\~=32
\lowercase{
 \gdef\isitcmd{%
        \let\c@ntinue\storep@stattribcmd
        \ifcat a\nxt\else\ifcat=\nxt
        \else \let\c@ntinue\end@ttributegrab\fi\fi\c@ntinue}
}
%\def\foo#1{Thatsit "#1"}

\def\oddc@tcodes{\catcode`"=11 \catcode`==11 \catcode`\ =11 \catcode`|=0
\catcode`\\=12}                                                                                 
\def\normalc@tcodes{\catcode`"=12 \catcode`==12 \catcode`\ =10\catcode`\\=0
\catcode`\|=12}                                                                              

\def\start@ttributegrab{\let\c@ntinue\isitshash\oddc@tcodes\futurelet\nxt\c@ntinue}
\def\end@ttributegrab{%
  \xdef\@ttributes{\x@\detokenize\x@{\@ttributes}}%
  \message{Now executing \p@stattribcmd}%
  \csname\p@stattribcmd\endcsname}

\oddc@tcodes
|gdef|isitshash{%
|let|c@ntinue|store@ttributes%
%|edef|@nnxt{|detokenize{|nxt}}
|if|nxt\|let|c@ntinue|startp@stattribcmd|normalc@tcodes%
|fi|c@ntinue}
|normalc@tcodes

%\grabwords one two three="hi"\foo{folks}
%
%Store=\store
%\def\firstword #1 #2 #3\end{Word:"#2" (#3)}
%\x@\firstword\store\end
%

